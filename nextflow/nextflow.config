// nextflow.config

params {
    // Input/Output
    input_dir = "test_data/ont_data"
    outdir = "results"
    
    // Resources
    threads = 30
    memory = '60.GB'
    
    // Filtlong parameters
    filtlong_min_length = 1000
    filtlong_keep_percent = 90
    filtlong_min_quality = 10
    
    // Help parameter
    help = false
}

// Process configuration
process {
    // Default settings
    cpus = { params.threads }
    memory = { params.memory }
    time = '50h'
    
    // NanoPlot process
    withName: 'NANOPLOT' {
        cpus = 30
        memory = '80.GB'
        time = '10h'
        publishDir = [
            path: "${params.outdir}/01_QC/nanoplot",
            mode: 'copy'
        ]
    }
    
    // Filtlong process
    withName: 'FILTLONG' {
        cpus = 30
        memory = '80.GB'
        time = '10h'
        publishDir = [
            path: "${params.outdir}/02_filtered",
            mode: 'copy'
        ]
    }
}

// Execution profiles
profiles {
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
        
        process {
            withName: 'NANOPLOT' {
                container = 'quay.io/biocontainers/nanoplot:1.42.0--pyhdfd78af_0'
            }
            withName: 'FILTLONG' {
                container = 'staphb/filtlong:0.2.1'
            }
        }
    }
}

// Reporting
timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
    overwrite = true
}

report {
    enabled = true
    file = "${params.outdir}/report.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
    overwrite = true
}